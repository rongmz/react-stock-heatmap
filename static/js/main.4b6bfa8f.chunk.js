(this["webpackJsonp@rongmz/react-stock-heatmap-example"]=this["webpackJsonp@rongmz/react-stock-heatmap-example"]||[]).push([[0],{57:function(e,t,n){e.exports=n(65)},58:function(e,t,n){},64:function(e,t,n){},65:function(e,t,n){"use strict";n.r(t);n(58);var a=n(1),i=n.n(a),o=n(50),r=n.n(o),d=n(11),l=n.n(d),s=n(51),u=n(5),c=n(53),f=n(8),w=n(12),g=n(39),x=n(26),h=n(52),m=n(55),v=n(54);var C=function(e){var t=new Set(e.map((function(e){var t=e.marketDepth;if(t){var n=t.buys.map((function(e){return+e.rate})),a=t.sells.map((function(e){return+e.rate}));return n.concat(a,[+t.lastTradedPrice])}return[]})).reduce((function(e,t){return e.concat(t)}),[]));return Array.from(t)},p=function(e){var t=e.marketDepth;if(t){var n=t.buys.map((function(e){return+e.qty})),a=t.sells.map((function(e){return+e.qty}));return n.concat(a)}return[]},b=function(e){var t=p(e).sort((function(e,t){return e-t}));return t.length>0?t[t.length-1]:1},k=function(e){var t=e.map((function(e){return e.marketDepth?+e.marketDepth.lastTradedQty:0})).sort((function(e,t){return e-t}));return t.length>0?t[t.length-1]:1},y=function(e,t){if(t||(t=2),e>59){if(e>3599){var n=e/3600;return n.toFixed(t)+" hour"+(n>1?"s":"")}var a=e/60;return a.toFixed(t)+" minute"+(a>1?"s":"")}return e+" second"+(e>1?"s":"")},D=Object.assign(Object.assign(Object.assign({},c,f,w),g,x,h),v,m),S=function(e){var t,n;function a(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(t=e.call.apply(e,[this].concat(a))||this).canvasRef=i.a.createRef(),t.drawingContext=null,t.data=[],t.windowedData=[],t.windowLength=40,t.windowPosition=0,t.autoScroll=!0,t.defaults={borderPadding:[5,5,0,0],bidAskWidth:100,axisYWidth:50,axisXHeight:50,buyColor:"#388e3c",textOnBuyColor:"#ffffff",sellColor:"#d32f2f",textOnSellColor:"#ffffff",textOnBackground:"#000000",textHighlightOnBackground:"#ff0000",tradeColor:"#7434eb",axisTickSize:6,axisColor:"#000000",xAxisTextPadding:6,yAxisTextPadding:6,bidAskGraphPaddingLeft:10,bidAskTransitionDuration:500,volumeCircleMaxRadius:10,runningRatioSeconds:5,hmWidth:function(){return t.props.width-t.defaults.borderPadding[1]-t.defaults.borderPadding[3]-t.defaults.bidAskWidth-t.defaults.axisYWidth},hmHeight:function(){return t.props.height-t.defaults.borderPadding[0]-t.defaults.borderPadding[2]-t.defaults.axisXHeight},clearColor:"#ffffff"},t.isMouseDown=!1,t.mouseDownX=0,t.attachMouseListeners=function(){null!==t.canvasRef.current&&(t.canvasRef.current.addEventListener("mousedown",t.eventMouseDown),t.canvasRef.current.addEventListener("mousemove",t.eventMouseMove),t.canvasRef.current.addEventListener("mouseup",t.eventMouseUp),t.canvasRef.current.addEventListener("wheel",t.eventZoomWheel),t.canvasRef.current.addEventListener("keydown",t.eventKeyDown))},t.detachMouseListeners=function(){null!==t.canvasRef.current&&(t.canvasRef.current.removeEventListener("mousedown",t.eventMouseDown),t.canvasRef.current.removeEventListener("mousemove",t.eventMouseMove),t.canvasRef.current.removeEventListener("mouseup",t.eventMouseUp),t.canvasRef.current.removeEventListener("wheel",t.eventZoomWheel),t.canvasRef.current.removeEventListener("keydown",t.eventKeyDown))},t.eventMouseDown=function(e){t.isMouseDown=!0,t.mouseDownX=e.x},t.eventMouseMove=function(e){if(t.isMouseDown){var n=e.x-t.mouseDownX,a=Math.floor(Math.abs(n)/t.xScale.bandwidth());a>0&&(t.mouseDownX=e.x),t.moveDataWindow(t.windowPosition+a*(n>=0?-1:1))}},t.eventMouseUp=function(e){t.isMouseDown=!1,t.mouseDownX=0},t.eventZoomWheel=function(e){var n,a=0;switch(e.deltaY<0?"zoom-in":"zoom-out"){case"zoom-in":a=Math.max(t.windowLength-1,3);break;case"zoom-out":a=Math.min(t.windowLength+1,t.data.length-1)}n=t.windowLength-a,t.windowLength=a,t.moveDataWindow(t.windowPosition+n)},t.eventKeyDown=function(e){switch(e.preventDefault(),console.log("key event",e.isComposing,e.key,e.ctrlKey),e.key){case"ArrowLeft":t.moveDataWindow(t.windowPosition-(e.ctrlKey?10:1));break;case"ArrowRight":t.moveDataWindow(t.windowPosition+(e.ctrlKey?10:1))}},t.xScale=null,t.bidAskScale=null,t.yScale=null,t.yDomainValues=null,t.bidAskAnimTimer=null,t.bidAskBarAnimConfig={},t.updateHeatmapDimensions=function(){var e=t.props,n=e.width,a=e.height;n>0&&a>0&&t.windowedData.length>0&&(t.xScale=D.scaleBand().range([0,t.defaults.hmWidth()]).domain(t.windowedData.map((function(e){return e.ts}))),t.yDomainValues=C(t.windowedData).sort((function(e,t){return e-t})),t.yScale=D.scaleBand().range([t.defaults.hmHeight(),0]).domain(t.yDomainValues),t.bidAskScale=D.scaleLinear().range([0,t.defaults.bidAskWidth]).domain([0,D.max(p(t.windowedData[t.windowedData.length-1]))]))},t.updateHeatmap=function(){null!==t.drawingContext&&(t.updateHeatmapDimensions(),t.clearCanvas(t.defaults.borderPadding[3],t.defaults.borderPadding[0],t.defaults.hmWidth(),t.defaults.hmHeight(),t.defaults.clearColor),t.drawMainGraph(),t.drawXAxis(),t.drawYAxisAndBidAskGraph(),t.drawBuy2SellRatio())},t.drawBuy2SellRatio=function(){if(t.windowedData.length>0){var e=t.windowedData[t.windowedData.length-1],n=t.defaults.borderPadding[3]+t.defaults.hmWidth()+t.defaults.axisTickSize,a=t.defaults.borderPadding[0]+t.defaults.hmHeight()+t.defaults.axisTickSize,i=t.props.width-n,o=t.props.height-a;t.clearCanvas(n,a,i,o,t.defaults.clearColor);var r=(o-10)/2;if(t.drawingContext.save(),t.drawingContext.textAlign="center",t.drawingContext.textBaseline="middle",t.drawingContext.font="bold "+r+"px sans-serif",t.drawingContext.fillText((e.marketDepth.buyOrderVolume/e.marketDepth.sellOrderVolume).toFixed(2),n+3*i/4,a+r/2),t.windowedData.length>=t.defaults.runningRatioSeconds){for(var d=0,l=0,s=t.windowedData.length-1;s>=t.windowedData.length-t.defaults.runningRatioSeconds;s--)d+=(t.windowedData[s].marketDepth.sells||[]).reduce((function(e,t){return e+t.qty}),0),l+=(t.windowedData[s].marketDepth.buys||[]).reduce((function(e,t){return e+t.qty}),0);var u=l/d;t.drawingContext.fillText(u.toFixed(2),n+i/4,a+.5*r)}t.drawingContext.font="bold 13px sans-serif",t.drawingContext.textBaseline="bottom",t.drawingContext.fillText("Buy/Sell",n+i/2,a+2*r+5),t.drawingContext.restore()}},t.drawXAxis=function(){var e;t.clearCanvas(t.defaults.borderPadding[3],t.defaults.borderPadding[0]+t.defaults.hmHeight(),t.defaults.hmWidth(),t.defaults.axisXHeight,t.defaults.clearColor),t.drawingContext.save(),t.drawingContext.beginPath(),t.drawingContext.translate(t.defaults.borderPadding[3],t.defaults.borderPadding[0]+t.defaults.hmHeight()),t.drawingContext.moveTo(0,0),t.drawingContext.lineTo(t.defaults.hmWidth(),0),t.drawingContext.textAlign="center",t.drawingContext.textBaseline="top";var n=t.drawingContext.measureText("77:77:77").width+20,a=parseInt(n/((null===(e=t.xScale)||void 0===e?void 0:e.bandwidth())||1))||1;t.windowedData.map((function(e,n){if(n%a===0){var i=t.xScale(e.ts);t.drawingContext.moveTo(i,0),t.drawingContext.lineTo(i,t.defaults.axisTickSize),t.drawingContext.fillText(e.ts,i,t.defaults.axisTickSize+t.defaults.xAxisTextPadding)}})),t.drawingContext.textAlign="left",t.drawingContext.font="12px Arial",t.drawingContext.fillText("Zoom Level:  "+y(t.windowLength),20,t.defaults.axisTickSize+t.defaults.xAxisTextPadding+20);var i=t.drawingContext.measureText("Zoom Level:  "+y(t.windowLength)).width,o=k(t.windowedData);t.drawingContext.fillText("Max Volume in "+y(t.windowLength,1)+":  ",20+i+20,t.defaults.axisTickSize+t.defaults.xAxisTextPadding+20),t.drawingContext.fillStyle=t.defaults.textHighlightOnBackground,i+=t.drawingContext.measureText("Max Volume in "+y(t.windowLength,1)+":  ").width,t.drawingContext.font="bold 12px Arial",t.drawingContext.fillText(""+o,20+i+20,t.defaults.axisTickSize+t.defaults.xAxisTextPadding+20),i+=t.drawingContext.measureText(""+o).width,t.windowedData.length>0&&(t.drawingContext.fillStyle=t.defaults.textOnBackground,t.drawingContext.fillText("LTP:  "+t.windowedData[t.windowedData.length-1].marketDepth.lastTradedPrice+"     LTQ:  "+t.windowedData[t.windowedData.length-1].marketDepth.lastTradedQty,20+i+40,t.defaults.axisTickSize+t.defaults.xAxisTextPadding+20)),t.drawingContext.fillStyle=t.defaults.textOnBackground,t.drawingContext.lineWidth=1.2,t.drawingContext.strokeStyle=t.defaults.axisColor,t.drawingContext.stroke(),t.drawingContext.restore()},t.drawYAxisAndBidAskGraph=function(){if(null!==t.yDomainValues){t.clearCanvas(t.defaults.borderPadding[3]+t.defaults.hmWidth(),t.defaults.borderPadding[0],t.defaults.axisYWidth,t.defaults.hmHeight()+t.defaults.axisTickSize,t.defaults.clearColor),t.drawingContext.save(),t.drawingContext.beginPath(),t.drawingContext.translate(t.defaults.borderPadding[3]+t.defaults.hmWidth(),t.defaults.borderPadding[0]),t.drawingContext.moveTo(0,0),t.drawingContext.lineTo(0,t.defaults.hmHeight()+t.defaults.axisTickSize),t.drawingContext.textAlign="start",t.drawingContext.textBaseline="top";var e=0;t.yDomainValues.map((function(n){var a=t.yScale(n);t.drawingContext.moveTo(0,a),t.drawingContext.lineTo(t.defaults.axisTickSize,a),t.drawingContext.fillText(n.toFixed(2),t.defaults.axisTickSize+t.defaults.yAxisTextPadding,a+2,t.defaults.axisYWidth-t.defaults.axisTickSize+t.defaults.yAxisTextPadding);var i=t.drawingContext.measureText(n.toFixed(2)).width;e=e>=i?e:i})),t.drawingContext.lineWidth=1.2,t.drawingContext.strokeStyle=t.defaults.axisColor,t.drawingContext.stroke(),t.drawingContext.restore();var n=t.defaults.borderPadding[3]+t.defaults.hmWidth()+e+t.defaults.axisTickSize+t.defaults.yAxisTextPadding+t.defaults.bidAskGraphPaddingLeft,a=t.defaults.borderPadding[0];t.drawBidAskGraph(n,a)}},t.drawBidAskGraph=function(e,n){t.windowedData.length>0&&(null!==t.bidAskAnimTimer&&(t.bidAskAnimTimer.stop(),t.bidAskAnimTimer=null),t.bidAskAnimTimer=D.timer((function(a){var i=Math.min(1,D.easeCubic(a/t.defaults.bidAskTransitionDuration));t.clearCanvas(e,n,t.defaults.bidAskWidth,t.defaults.hmHeight()+t.defaults.axisTickSize,t.defaults.clearColor);var o=t.yScale.bandwidth()-2,r=t.windowedData[t.windowedData.length-1],d=b(r);t.drawingContext.save(),t.drawingContext.translate(e,n),t.drawingContext.lineWidth=0,t.drawingContext.textBaseline="middle";var l=function(e,n,a){e.map((function(e){t.drawingContext.fillStyle=n;var r=t.defaults.bidAskWidth*(+e.qty/d);t.bidAskBarAnimConfig[e.rate]=D.interpolateNumber(t.bidAskBarAnimConfig[e.rate]||0,r)(i),t.drawingContext.fillRect(0,t.yScale(e.rate),t.bidAskBarAnimConfig[e.rate],o);var l=t.drawingContext.measureText(e.qty).width;t.defaults.bidAskWidth-t.bidAskBarAnimConfig[e.rate]-2>=l?(t.drawingContext.textAlign="start",t.drawingContext.fillStyle=t.defaults.textOnBackground,t.drawingContext.fillText(e.qty,t.bidAskBarAnimConfig[e.rate]+2,t.yScale(e.rate)+o/2+1)):(t.drawingContext.textAlign="end",t.drawingContext.fillStyle=a,t.drawingContext.fillText(e.qty,t.bidAskBarAnimConfig[e.rate]-2,t.yScale(e.rate)+o/2+1))}))};l(r.marketDepth.buys,t.defaults.buyColor,t.defaults.textOnBuyColor),l(r.marketDepth.sells,t.defaults.sellColor,t.defaults.textOnSellColor),t.drawingContext.restore(),1===i&&t.bidAskAnimTimer.stop()})))},t.drawMainGraph=function(){if(t.drawingContext.save(),t.xScale&&t.yScale&&t.bidAskScale&&null!==t.drawingContext){var e=k(t.windowedData);t.xScale.bandwidth(),t.yScale.bandwidth();t.drawingContext.translate(t.defaults.borderPadding[3],t.defaults.borderPadding[0]),t.windowedData.map((function(n){var a=n.marketDepth,i=n.ts,o=b(n);if(a.buys&&a.buys.length>0){var r=D.color(t.defaults.buyColor).rgb();a.buys.map((function(e){r.opacity=e.qty/o,t.drawingContext.fillStyle=r.toString(),t.drawingContext.fillRect(t.xScale(i),t.yScale(e.rate),t.xScale.bandwidth(),t.yScale.bandwidth())}))}if(a.sells&&a.sells.length>0){var d=D.color(t.defaults.sellColor).rgb();a.sells.map((function(e){d.opacity=e.qty/o,t.drawingContext.fillStyle=d.toString(),t.drawingContext.fillRect(t.xScale(i),t.yScale(e.rate),t.xScale.bandwidth(),t.yScale.bandwidth())}))}var l=D.color(t.defaults.tradeColor).rgb();l.opacity=1,t.drawingContext.lineWidth=1,t.drawingContext.fillStyle=l.toString();var s=t.defaults.volumeCircleMaxRadius*(+a.lastTradedQty/e);t.drawingContext.beginPath(),t.drawingContext.arc(t.xScale(i),t.yScale(+a.lastTradedPrice),s,0,2*Math.PI),t.drawingContext.fill()})),t.drawingContext.beginPath(),D.line().x((function(e){return t.xScale(e.ts)})).y((function(e){return t.yScale(+e.marketDepth.lastTradedPrice)})).curve(D.curveLinear).context(t.drawingContext)(t.windowedData),t.drawingContext.lineWidth=1,t.drawingContext.strokeStyle=t.defaults.tradeColor,t.drawingContext.stroke()}t.drawingContext.restore()},t.clearCanvas=function(e,n,a,i,o){null!==t.drawingContext&&(t.drawingContext.save(),t.drawingContext.fillStyle=o||t.defaults.clearColor,t.drawingContext.fillRect(e,n,a,i),t.drawingContext.restore())},t.setData=function(e){e&&e.length>0&&(t.data=e,t.updateWindowedData())},t.addData=function(e){"object"===typeof e&&(t.data.push(e),t.updateWindowedData())},t.updateWindowedData=function(){t.moveDataWindow(t.data.length-t.windowLength-1)},t.moveDataWindow=function(e){e!==t.windowPosition&&e>-1&&e<t.data.length-t.windowLength&&(t.windowedData=t.data.slice(e,e+t.windowLength),t.windowPosition=e,t.windowPosition===t.data.length-t.windowLength-1&&(t.autoScroll=!0),t.updateHeatmap())},t.setZoomLevel=function(e){var n=Math.min(Math.max(e,3),t.data.length-1),a=t.windowLength-n;t.windowLength=n,t.moveDataWindow(t.windowPosition+a)},t}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var o=a.prototype;return o.shouldComponentUpdate=function(e,t){var n=this.props.width!==e.width||this.props.height!==e.height;return n&&this.detachMouseListeners(),n},o.componentDidMount=function(){null!==this.canvasRef.current&&(this.drawingContext=this.canvasRef.current.getContext("2d"),this.updateHeatmap(),this.attachMouseListeners())},o.componentDidUpdate=function(){null!==this.canvasRef.current&&(this.drawingContext=this.canvasRef.current.getContext("2d"),this.updateHeatmap(),this.attachMouseListeners())},o.componentWillUnmount=function(){this.detachMouseListeners()},o.render=function(){var e=this.props,t=e.width,n=e.height;return i.a.createElement("canvas",{ref:this.canvasRef,width:t||300,height:n||150,tabIndex:1,style:{display:"block",width:"100%",height:"100%",cursor:"crosshair"}})},a}(i.a.Component),A=(n(64),function(){var e=i.a.useState(!0),t=Object(u.a)(e,2),n=t[0],a=t[1],o=i.a.useRef(null),r=i.a.useRef(null),d=i.a.useState([0,0]),c=Object(u.a)(d,2),f=c[0],w=c[1];return i.a.useEffect((function(){a(!0),fetch("20200814").then(function(){var e=Object(s.a)(l.a.mark((function e(t){var n,i,d,s,u,c,f,w,g,x,h,m,v,C,p;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.body,i=t.headers,d=n.getReader(),s=+i.get("Content-Length"),u=0,c=[];case 5:return e.next=8,d.read();case 8:if(f=e.sent,w=f.done,g=f.value,!w){e.next=13;break}return e.abrupt("break",18);case 13:c.push(g),u+=g.length,null!==o.current&&(o.current.innerHTML=" Downloading ".concat((100*u/s).toFixed(1),"% ...")),e.next=5;break;case 18:for(x=new Uint8Array(u),h=0,m=0,v=c;m<v.length;m++)C=v[m],x.set(C,h),h+=C.length;p=new TextDecoder("utf-8").decode(x),null!==r.current&&r.current.setData(p.split("\n").filter((function(e){return""!==e.trim()})).map((function(e){return JSON.parse(e)}))),a(!1);case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[]),i.a.useEffect((function(){var e=function(){w([window.innerWidth,window.innerHeight])};return e(),window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),i.a.createElement(i.a.Fragment,null,n&&i.a.createElement("div",{className:"loadingIndicator"},i.a.createElement("div",{className:"loadingSpinner"},i.a.createElement("div",{className:"loader"},"Loading...")),i.a.createElement("div",{ref:o}," Downloading 0% ...")),i.a.createElement(S,{ref:r,width:f[0],height:f[1]}),i.a.createElement("div",{className:"btnContainer"},i.a.createElement("button",{onClick:function(){null!==r.current&&r.current.setZoomLevel(60)}},"zoom 1 minute"),i.a.createElement("button",{onClick:function(){null!==r.current&&r.current.setZoomLevel(120)}},"zoom 2 minutes"),i.a.createElement("button",{onClick:function(){null!==r.current&&r.current.setZoomLevel(180)}},"zoom 3 minutes"),i.a.createElement("button",{onClick:function(){null!==r.current&&r.current.setZoomLevel(240)}},"zoom 4 minutes"),i.a.createElement("button",{onClick:function(){null!==r.current&&r.current.setZoomLevel(300)}},"zoom 5 minutes"),i.a.createElement("button",{onClick:function(){null!==r.current&&r.current.setZoomLevel(600)}},"zoom 10 minutes"),i.a.createElement("button",{onClick:function(){var e=window.prompt("Enter HH:mm:ss","00:00:00").split(":"),t=3600*(+e[0]-9)+60*+e[1]+ +e[2];null!==r.current&&r.current.moveDataWindow(t)}},"Set Position")))});r.a.render(i.a.createElement(A,null),document.getElementById("root"))}},[[57,1,2]]]);
//# sourceMappingURL=main.4b6bfa8f.chunk.js.map